# 后置操作符

## 问号-可空类型

dart 2.12 及之后的版本中，引入了空安全（null safety），这意味着你必须明确地指出一个变量是否能被赋值为 `null`。这是空安全特性的一部分，它有助于防止运行时出现空引用错误，因为编码时你需要显式地处理可能为 `null` 的情况。例如，当你使用 `pageController` 变量时，你必须确保它不是 `null`，或者你必须与其它代码对它的可能为 `null` 的情况进行处理。

```dart
// 重点，pageController可以被赋值为 `null`。如果没有 `?`，就无法被赋值为 `null`，如果企图这么做，编译时将会报错。
PageController? pageController0; 
PageController? pageController1; 

void myFunction() {
    // 以下代码行报错
    // The method 'jumpTo' can't be unconditionally invoked because the receiver can be 'null'.
    // Try making the call conditional (using '?.') or adding a null check to the target ('!').
    controller0.jumpTo(0); 

  // 在这里，我们必须检查 pageController 是否为 null
  if (pageController != null) {
    // pageController 已经被初始化，可以通过x!.的方式来安全使用
    pageController!.jumpTo(0);
  } else {
    // 如果 pageController 是 null，则需要处理此情形
    // 比如：初始化 pageController 或给出提示等
  }
}
```

## 问号-非空断言操作符（Null Assertion Operator）

 在启用空安全的Dart代码中，如果你有一个可空类型的变量（例如 `int?`），它的值可能是 `null` 或者一个整数。如果你确定这个变量在某个上下文中一定不为 `null`，你可以使用感叹号 `!` 来断言这个变量此时非空，这样就可以作为非空类型使用。这称为非空断言操作符。

```dart
PageController? controller;
controller = PageController();
controller!.jumpToPage(0); // 非空断言，因为我们知道此时它不是null
```

如果你错误地使用了 `!` 而变量的值实际上是 `null`，运行时会抛出一个异常。

## 条件成员访问操作符（空感知调用

它允许你在对象不为 null 时调用它的成员（如方法、属性等）。如果对象为 null，它将不执行任何操作，并且整个表达式的结果也是 null。

```dart
controller?.jumpToPage(0);
```

`controller` 是一个可能为 null 的对象, `?.` 确保只有在 `controller` 不为 null 的时候才会尝试调用 `jumpToPage()` 方法。


## 双问号-空合并运算（null coalescing）

其作用是当表达式的值为 `null` 时提供一个默认值。这在处理可能为 null 的值时可以非常有用，它可以帮助你优雅地设置后备值（fallback value）或默认值。

```dart
var value = possibleNullValue ?? defaultValue;
```

如果 `possibleNullValue` 不是 `null`，`value` 将被赋为 `possibleNullValue` 的值。如果 `possibleNullValue` 是 `null`，那么 `value` 将被赋为后面的 `defaultValue`。

```dart
String? userComment; // 这个变量可能是 null
String message = userComment ?? 'No comment provided'; // 如果 userComment 是 null，则使用默认字符串
```

在这个例子中，`userComment` 可能是一个未定义（`null`）的用户评论。然而，我们希望不管 `userComment` 是否有值，都能得到一个非空的字符串 `message`。如果 `userComment` 为 `null`，则 `message` 被设置为 `'No comment provided'`。

双问号操作符 `??` 是处理可能为空的变量时增强代码可读性和简洁性的一个好方法，尤其是在空安全的Dart代码中。它防止了写过多的条件语句来检查 `null` 值，并且提供了一种流畅的方式来指定默认值。 


## 级联调用（Cascade Notation）

这种语法主要使用两个点 `..` 来表示，允许你在同一个对象上进行多次操作或调用，而不需要重复引用该对象。这种方式尤其有助于对对象进行一系列设置或配置时，能使代码看起来更加简洁，它特别适用于初始化和配置对象的情况。 

```dart
var paint = Paint();
paint.color = Colors.black;
paint.strokeCap = StrokeCap.round;

// 以上代码通过级联操作符简写如下：

// 级联属性设置：
var paint = Paint()
      ..color = Colors.black
      ..strokeCap = StrokeCap.round;

// 级联方法调用
var path = Path()
      ..moveTo(0, 0)
      ..lineTo(100, 100)
      ..close();
```

值得注意的是，级联操作符只能应用在返回`void`的操作上。如果级联中一个方法返回了一个值并且你想要使用这个值，你就不能使用级联来调用这个方法。需要在单独的语句中处理那些返回值。

```dart

// 这不会起作用，因为 toList() 返回了一个新的 List
var list = []
  ..add(1)
  ..add(2)
  ..toList(); 

// 如果你需要使用返回值进行操作，就需要把这部分操作放在级联之外：
var list = []..add(1)..add(2);
var newList = list.toList(); // 正确地处理了 toList() 的返回值
```